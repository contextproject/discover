@(url: String, randStart: Double)

@main(randStart) {

    <div class="widgetContainer">
        <iframe id="sc-widget" src="https://w.soundcloud.com/player/?url=http://@url" width="100%" height="295" scrolling="no" frameborder="no"></iframe>
    </div>

    <div class="actionsContainer">
        <input class="urlInput" placeholder="Enter SoundCloud URL of the track." type="text">
        <button class="reload" action="">Reload</button>
        <input class="idInput" placeholder="Enter the ID of a track." type="text">
        <button class="getTrack" action="">Get Track</button>

        <dl class="actionButtons">
            <dd><button class="seekTo">
                Seek <input type="text" value="50000" size="10" maxlength="10" /></button></dd>
            <dd><button class="preview" value=@randStart>Preview</button></dd>
            <dd><button class="prev">Prev</button></dd>
            <dd><button class="next">Next</button></dd>
            <dd><button class="randSong">Random Song</button></dd>
            <dd><button class="clear">Clear Events</button></dd>
            <dd><input type="image" src="@routes.Assets.at("images/connect.png")" class="connect"></dd>
        </dl>
    </div>

    <script>
    var widgetIframe = document.getElementById('sc-widget');
    
    //Template for adding event listeners.
    function addEvent(element, eventName, callback) {
        if (element.addEventListener) {
            element.addEventListener(eventName, callback, false);
        } else {
            element.attachEvent(eventName, callback, false);
        }
    }
    
    //Adding the functionality of reloading the wiidget with a given url.
    var getButton = document.querySelector('.getTrack');
    var idInput = document.querySelector('.idInput');

    addEvent(getButton, 'click', function() {
        window.location.href = window.location.protocol + idInput.value;
    });
    

    var connectButton = document.querySelector('.connect');

    addEvent(connectButton, 'click', function() {
    	if (SC.accessToken() == null) {
            SC.connect(function() {
                SC.get('/me', function(me) {
                    SC.Widget(widgetIframe).load("api.soundcloud.com/users/" + me.id + "/favorites", {});
    	            document.querySelector(".connect").src = "@routes.Assets.at("images/disconnect.png")";
    	        });
    	    });
    	} else {
            SC.accessToken(null);
            SC.Widget(widgetIframe).load("@url", {});
    	    document.querySelector(".connect").src = "@routes.Assets.at("images/connect.png")";
    	}
    });
    </script>
}
